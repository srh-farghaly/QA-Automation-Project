version: 2.1

orbs:
  node: circleci/node@4.7.0
  browser-tools: circleci/browser-tools@1.1.0

jobs:
  ui_tests:
    docker:
      - image: cimg/node:lts-browsers # Use Node.js with browsers pre-installed
    working_directory: ~/project/QA-automation-Task
    steps:
      - checkout # Pull the latest code
      - browser-tools/install-browser-tools # Install browser tools
      - run:
          name: Install ChromeDriver via npm
          command: npm install chromedriver --save-dev # Install ChromeDriver
      - node/install-packages # Install project dependencies
      - run:
          name: Verify config file
          command: ls -l nightwatch.json # Ensure config file exists
      - run:
          name: Run Nightwatch tests
          command: |
            mv nightwatch.json nightwatch.conf.js  # Rename config if needed
            npx nightwatch --config nightwatch.conf.js --env default

  api_tests:
    docker:
      - image: cimg/node:lts # Use a standard Node.js image for API tests
    working_directory: ~/project/supertest-jest-api
    steps:
      - checkout
      - node/install-packages # Install dependencies
      - run:
          name: Start API server
          command: npm run dev &
      - run:
          name: Run API tests
          command: npm test

workflows:
  version: 2
  e2e-test:
    jobs:
      - ui_tests
      - api_tests:
          requires:
            - ui_tests
