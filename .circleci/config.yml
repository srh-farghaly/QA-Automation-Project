version: 2.1

orbs:
  node: circleci/node@4.7.0
  browser-tools: circleci/browser-tools@1.1.0

jobs:
  ui_tests:
    docker:
      - image: cimg/node:lts-browsers # Pre-installed browsers with Node.js
    working_directory: ~/project/QA-automation-Task
    steps:
      - checkout # Pull the latest code from your repository
      - browser-tools/install-browser-tools # Install browser tools
      - node/install-packages # Install dependencies from package.json
      - run:
          name: Verify config file
          command: ls -l nightwatch.json
      - run:
          name: Run Nightwatch tests
          command: |
            mv nightwatch.json nightwatch.conf.js  # Rename the config if necessary
            npx nightwatch --config nightwatch.conf.js --env default

  api_tests:
    docker:
      - image: cimg/node:lts
    working_directory: ~/project/supertest-jest-api
    steps:
      - checkout
      - node/install-packages # Install dependencies for API tests
      - run:
          name: Start API server
          command: npm run dev &
      - run:
          name: Run API tests
          command: npm test

workflows:
  version: 2
  e2e-test:
    jobs:
      - ui_tests
      - api_tests:
          requires:
            - ui_tests
